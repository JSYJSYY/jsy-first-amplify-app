/** * Reads SSM environment context from a known Amplify environment variable, * fetches values from SSM and places those values in the corresponding environment variables */export const internalAmplifyFunctionResolveSsmParams = async (client) => {    const envPathObject = JSON.parse(process.env.AMPLIFY_SSM_ENV_CONFIG ?? '{}');    const paths = Object.values(envPathObject).map((paths) => paths.path);    if (paths.length === 0) {        return;    }    let actualSsmClient;    if (client) {        actualSsmClient = client;    }    else {        const ssmSdk = await import('@aws-sdk/client-ssm');        actualSsmClient = new ssmSdk.SSM();    }    const chunkArray = (array, chunkSize) => {        const chunks = [];        for (let i = 0; i < array.length; i += chunkSize) {            chunks.push(array.slice(i, i + chunkSize));        }        return chunks;    };    const resolveSecrets = async (paths) => {        const response = (await Promise.all(chunkArray(paths, 10).map(async (chunkedPaths) => await actualSsmClient.getParameters({            Names: chunkedPaths,            WithDecryption: true,        })))).reduce((accumulator, res) => {            accumulator.Parameters?.push(...(res.Parameters ?? []));            accumulator.InvalidParameters?.push(...(res.InvalidParameters ?? []));            return accumulator;        }, {            Parameters: [],            InvalidParameters: [],        });        if (response.Parameters && response.Parameters.length > 0) {            for (const parameter of response.Parameters) {                if (parameter.Name) {                    const envKey = Object.keys(envPathObject).find((key) => envPathObject[key].sharedPath === parameter.Name ||                        envPathObject[key].path === parameter.Name);                    if (envKey) {                        process.env[envKey] = parameter.Value;                    }                }            }        }        return response;    };    const response = await resolveSecrets(paths);    const sharedPaths = (response?.InvalidParameters || [])        .map((invalidParam) => Object.values(envPathObject).find((paths) => paths.path === invalidParam)?.sharedPath)        .filter((sharedParam) => !!sharedParam);     if (sharedPaths.length > 0) {        await resolveSecrets(sharedPaths);    }};await internalAmplifyFunctionResolveSsmParams();const SSM_PARAMETER_REFRESH_MS = 1000 * 60;setInterval(async () => {    try {        await internalAmplifyFunctionResolveSsmParams();    }    catch (error) {        try {                        console.debug(error);                    }        catch {                    }    }}, SSM_PARAMETER_REFRESH_MS);export {};
import{createRequire as f}from"node:module";import y from"node:path";import D from"node:url";global.require=f(import.meta.url);global.__filename=D.fileURLToPath(import.meta.url);global.__dirname=y.dirname(__filename);var S="https://edmtrain.com/api/events",M=async s=>{let{city:t,state:n,latitude:r,longitude:d,startDate:l,endDate:i}=s.arguments;try{let a=new URLSearchParams;t&&a.append("city",t),n&&a.append("state",n),r&&d&&(a.append("latitude",r.toString()),a.append("longitude",d.toString()),a.append("radius","50"));let c=new Date,o=new Date;o.setDate(o.getDate()+30),a.append("startDate",l||c.toISOString().split("T")[0]),a.append("endDate",i||o.toISOString().split("T")[0]),process.env.EDMTRAIN_API_KEY&&a.append("client",process.env.EDMTRAIN_API_KEY);let g=await fetch(`${S}?${a.toString()}`);if(!g.ok)return console.warn("EDMTrain API error, using mock data"),p(t||"San Francisco",n||"CA");let u=(await g.json()).data?.map(e=>({eventId:e.id?.toString()||`edm-${Date.now()}-${Math.random()}`,name:e.name||"EDM Event",date:e.date,startTime:e.startTime,endTime:e.endTime,venue:{id:e.venue?.id,name:e.venue?.name,address:e.venue?.address,city:e.venue?.city,state:e.venue?.state,latitude:e.venue?.latitude,longitude:e.venue?.longitude},artists:e.artistList?.map(m=>({id:m.id,name:m.name,bio:m.bio}))||[],genres:I(e),ages:e.ages,festivalInd:e.festivalInd,electronicGenreInd:e.electronicGenreInd,otherGenreInd:e.otherGenreInd,link:e.link,ticketLink:e.ticketLink,imageUrl:e.imageUrl||h(e.name),city:e.venue?.city,state:e.venue?.state,latitude:e.venue?.latitude,longitude:e.venue?.longitude}))||[];return{events:u,total:u.length,location:{city:t||u[0]?.city||"Unknown",state:n||u[0]?.state||"Unknown"}}}catch(a){return console.error("Error fetching EDM events:",a),p(t||"San Francisco",n||"CA")}};function I(s){let t=[],n=`${s.name||""} ${s.artistList?.map(r=>r.name).join(" ")||""}`.toLowerCase();return(n.includes("house")||n.includes("tech house"))&&t.push("House"),n.includes("techno")&&t.push("Techno"),(n.includes("bass")||n.includes("dubstep"))&&t.push("Bass"),n.includes("trance")&&t.push("Trance"),(n.includes("drum")||n.includes("dnb"))&&t.push("Drum & Bass"),n.includes("hardstyle")&&t.push("Hardstyle"),n.includes("melodic")&&t.push("Melodic"),n.includes("progressive")&&t.push("Progressive"),t.length===0&&s.electronicGenreInd&&t.push("Electronic Dance Music"),t}function h(s){let t=["edm","concert","festival","rave","electronic","music"];return`https://source.unsplash.com/400x400/?${t[Math.floor(Math.random()*t.length)]},night`}function p(s,t){let r={"San Francisco":[{name:"The Great Northern",address:"119 Utah St",latitude:37.768,longitude:-122.4058},{name:"Public Works",address:"161 Erie St",latitude:37.7526,longitude:-122.4195}],"Los Angeles":[{name:"Exchange LA",address:"618 S Spring St",latitude:34.043,longitude:-118.2516},{name:"Academy LA",address:"6021 Hollywood Blvd",latitude:34.102,longitude:-118.321}],"New York":[{name:"Brooklyn Mirage",address:"140 Stewart Ave",latitude:40.7114,longitude:-73.926},{name:"Nowadays",address:"56-06 Cooper Ave",latitude:40.7138,longitude:-73.9242}]}[s]||[{name:"EDM Club",address:"123 Main St",latitude:37.7749,longitude:-122.4194}],d=[{artists:[{name:"Lane 8"},{name:"Yotto"}],genres:["Deep House","Progressive House"]},{artists:[{name:"Charlotte de Witte"},{name:"Amelie Lens"}],genres:["Techno","Minimal Techno"]},{artists:[{name:"Porter Robinson"},{name:"Madeon"}],genres:["Future Bass","Melodic Dubstep"]}],l=[];for(let i=0;i<5;i++){let a=d[i%d.length],c=r[i%r.length],o=new Date;o.setDate(o.getDate()+i*7),l.push({eventId:`mock-${Date.now()}-${i}`,name:`${a.artists[0].name} presents ${a.genres[0]} Night`,date:o.toISOString().split("T")[0],startTime:"22:00",endTime:"03:00",venue:{...c,city:s,state:t},artists:a.artists,genres:a.genres,ages:i%2===0?"18+":"21+",festivalInd:!1,electronicGenreInd:!0,otherGenreInd:!1,link:"#",ticketLink:"#",imageUrl:h(a.artists[0].name),city:s,state:t,latitude:c.latitude,longitude:c.longitude})}return{events:l,total:l.length,location:{city:s,state:t}}}export{M as handler};
//# sourceMappingURL=index.mjs.map
